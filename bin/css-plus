#!/usr/bin/env node

const fs = require('fs')
const path = require('path')
const {convertNodeJS} = require('../src/helper/node')
const argv = require('yargs').argv

let cssPath = argv.css || argv._[0]
let htmlPath = argv.html || argv._[1]
let htmlOutputPath = argv.output || argv._[2]


if (!cssPath) { console.error('Missing CSS file'); process.exit(1) }
if (!htmlPath) { console.error('Missing HTML input file'); process.exit(1) }
if (!htmlOutputPath) { console.error('Missing HTML output file'); process.exit(1) }


const htmlOutputSourceMapPath = `${htmlOutputPath}.map`
const htmlOutputSourceMapFilename = path.basename(htmlOutputSourceMapPath)
const cssContents = fs.readFileSync(cssPath)
const htmlContents = fs.readFileSync(htmlPath)


convertNodeJS(cssContents, htmlContents, cssPath, htmlPath, htmlOutputPath, argv).then(({html: actualOutput, sourceMap}) => {
  fs.writeFileSync(htmlOutputPath, actualOutput)
  fs.writeFileSync(htmlOutputSourceMapPath, sourceMap)
})
